#stage 1
FROM node:16.14.0 as node
WORKDIR /app

ARG API_URL
ARG REPORTS_ALARMS_SHOW_EXPORT_WITHOUT_FILTERS
ARG PUSHER_APP_CHANNEL
ARG PUSHER_APP_KEY
ARG GUIDE_API_URL
ARG GUIDE_API_TOKEN

ENV API_URL=${API_URL}
ENV REPORTS_ALARMS_SHOW_EXPORT_WITHOUT_FILTERS=${REPORTS_ALARMS_SHOW_EXPORT_WITHOUT_FILTERS}
ENV PUSHER_APP_CHANNEL=${PUSHER_APP_CHANNEL}
ENV PUSHER_APP_KEY=${PUSHER_APP_KEY}
ENV GUIDE_API_URL=${GUIDE_API_URL}
ENV GUIDE_API_TOKEN=${GUIDE_API_TOKEN}

COPY . .

RUN npm install
RUN npm run ci:environemnt
RUN npm run ci:style:rac
RUN npm run build:parent

#stage 2
FROM nginx:alpine
COPY --from=node /app/dist/exeros-panel-parent /usr/share/nginx/html
