<ng-container *appHasPermission="[[accessGroup.DASHBOARD_VIEWER]]">
  <ng-container *ngIf="{ dashboard: dashboard$ | async, loading: dashboardLoading$ | async } as vm">
    <div class="grid grid-cols-4 auto-rows-auto gap-4 stagger-fade-in">
      <!-- KPI Cards Row -->
      <app-card variant="metric" [loading]="!!vm.loading && !vm.dashboard">
        <div card-body>
          <app-card-metric
            [value]="(vm.dashboard?.driver_checks ?? 0) + '%'"
            label="Driver Checks">
          </app-card-metric>
        </div>
      </app-card>

      <app-card variant="metric" [loading]="!!vm.loading && !vm.dashboard">
        <div card-body>
          <app-card-metric
            [value]="vm.dashboard?.accident_qty ?? 0"
            label="Accidents">
          </app-card-metric>
        </div>
      </app-card>

      <app-card variant="metric" [loading]="!!vm.loading && !vm.dashboard">
        <div card-body>
          <app-card-metric
            [value]="(vm.dashboard?.distance_driven ?? 0 | truncate | number : '1.0-0') + ' Miles'"
            label="Distance Driven">
          </app-card-metric>
        </div>
      </app-card>

      <app-card variant="metric" [loading]="!!vm.loading && !vm.dashboard">
        <div card-body>
          <app-card-metric
            [value]="(vm.dashboard?.mdvr?.active_count ?? 0) + '/' + (vm.dashboard?.mdvr?.all_count ?? 0)"
            label="Online History">
          </app-card-metric>
        </div>
      </app-card>

      <!-- Chart Cards Row -->
      <app-card class="col-span-2" variant="chart" [loading]="!!vm.loading && !vm.dashboard">
        <div card-body>
          <app-dashboard-core-driving-time></app-dashboard-core-driving-time>
        </div>
      </app-card>

      <app-card class="col-span-2" variant="chart" [loading]="!!vm.loading && !vm.dashboard">
        <div card-body>
          <app-dashboard-core-events></app-dashboard-core-events>
        </div>
      </app-card>

      <!-- Data Cards Row -->
      <app-card [loading]="!!vm.loading && !vm.dashboard">
        <div card-body class="min-h-[400px]">
          <app-dashboard-core-vehicles-checks></app-dashboard-core-vehicles-checks>
        </div>
      </app-card>

      <app-card [loading]="!!vm.loading && !vm.dashboard">
        <div card-body class="min-h-[400px]">
          <app-dashboard-core-accidents></app-dashboard-core-accidents>
        </div>
      </app-card>

      <app-card class="col-span-2" [loading]="!!vm.loading && !vm.dashboard">
        <div card-body class="min-h-[400px]">
          <app-dashboard-core-map></app-dashboard-core-map>
        </div>
      </app-card>
    </div>
  </ng-container>
</ng-container>
