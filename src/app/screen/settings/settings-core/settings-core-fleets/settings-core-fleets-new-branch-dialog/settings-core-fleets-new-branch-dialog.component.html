<app-dialog-container title="{{ title }}">
  <div class="flex flex-col gap-8 p-4" body>
    <div class="flex flex-col gap-4">
      <app-text-control label="Fleet name*" [formControl]="bodyGroup.controls.name" [showHintSpace]="false"></app-text-control>
      <app-tree-control label="Parent fleet" *ngIf="fleetOptions$ | async as options" [options]="options" [formControl]="bodyGroup.controls.fleet_id"></app-tree-control>
      <app-select-control label="Phase" *ngIf="phasesOptions$ | async as phasesOptions" [options]="phasesOptions" [formControl]="bodyGroup.controls.phase"></app-select-control>
      <app-tree-control label="Allowed custom event types" [options]="customEventTypes" [multiple]="true" [formControl]="bodyGroup.controls.custom_event_types"> </app-tree-control>
      <app-select-control label="Driver mode" [formControl]="bodyGroup.controls.driver_mode" [options]="driverModeOptions" [clearable]="true" [showSearchInput]="false"></app-select-control>
      <p class="font-medium">Speeding Alarm settings</p>
      <app-text-control label="Minimum Time Between Events (min) (min. 2)" type="number" [min]="2" [step]="1" [showHintSpace]="false" [formControl]="bodyGroup.controls.speeding_event_cooldown_minutes"></app-text-control>
      <app-text-control label="Speeding Margin (%)" type="number" [min]="0" [step]="1" [showHintSpace]="false" [formControl]="bodyGroup.controls.speeding_event_percentage_trigger"></app-text-control>
    </div>
    <div class="flex flex-col gap-4">
      <p class="font-medium">Assign New Vehicle</p>
      <app-text-control label="Search vehicles*" [showHintSpace]="false" [formControl]="searchControl" prefixIcon="search"></app-text-control>
      <div class="flex items-center gap-2">
        <svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M7.22264 11.4146C7.39428 11.4146 7.53814 11.3566 7.65424 11.2405C7.77034 11.1244 7.82839 10.9805 7.82839 10.8089C7.82839 10.6372 7.77034 10.4934 7.65424 10.3773C7.53814 10.2612 7.39428 10.2031 7.22264 10.2031C7.051 10.2031 6.90713 10.2612 6.79103 10.3773C6.67493 10.4934 6.61688 10.6372 6.61688 10.8089C6.61688 10.9805 6.67493 11.1244 6.79103 11.2405C6.90713 11.3566 7.051 11.4146 7.22264 11.4146ZM7.22288 8.67425C7.38233 8.67425 7.5159 8.62035 7.62359 8.51253C7.73128 8.40473 7.78512 8.27115 7.78512 8.11177V4.73673C7.78512 4.57737 7.73119 4.44378 7.62334 4.33597C7.51548 4.22816 7.38183 4.17425 7.22239 4.17425C7.06294 4.17425 6.92938 4.22816 6.82169 4.33597C6.714 4.44378 6.66016 4.57737 6.66016 4.73673V8.11177C6.66016 8.27115 6.71408 8.40473 6.82193 8.51253C6.92979 8.62035 7.06344 8.67425 7.22288 8.67425ZM7.22389 14.9915C6.23844 14.9915 5.31217 14.8045 4.44507 14.4305C3.57796 14.0565 2.82369 13.549 2.18228 12.9079C1.54086 12.2667 1.03306 11.5128 0.6589 10.6461C0.284738 9.77935 0.0976562 8.85327 0.0976562 7.86782C0.0976562 6.88237 0.284656 5.95609 0.658656 5.08899C1.03266 4.22188 1.54022 3.46762 2.18134 2.8262C2.82248 2.18478 3.57641 1.67698 4.44314 1.30282C5.30985 0.928659 6.23593 0.741577 7.22138 0.741577C8.20683 0.741577 9.13311 0.928578 10.0002 1.30258C10.8673 1.67658 11.6216 2.18414 12.263 2.82526C12.9044 3.4664 13.4122 4.22033 13.7864 5.08706C14.1605 5.95377 14.3476 6.87985 14.3476 7.8653C14.3476 8.85075 14.1606 9.77703 13.7866 10.6441C13.4126 11.5112 12.9051 12.2655 12.2639 12.9069C11.6228 13.5483 10.8689 14.0561 10.0021 14.4303C9.13543 14.8045 8.20934 14.9915 7.22389 14.9915ZM7.22264 13.8666C8.89764 13.8666 10.3164 13.2853 11.4789 12.1228C12.6414 10.9603 13.2226 9.54156 13.2226 7.86656C13.2226 6.19156 12.6414 4.77281 11.4789 3.61031C10.3164 2.44781 8.89764 1.86656 7.22264 1.86656C5.54764 1.86656 4.12889 2.44781 2.96639 3.61031C1.80389 4.77281 1.22264 6.19156 1.22264 7.86656C1.22264 9.54156 1.80389 10.9603 2.96639 12.1228C4.12889 13.2853 5.54764 13.8666 7.22264 13.8666Z" fill="#64677A" />
        </svg>
        <span class="text-neutral-700 text-xs font-medium"> Choosing an already assigned vehicle will cause detaching it from a current branch. </span>
      </div>
      <div class="h-56 overflow-y-auto">
        <table>
          <thead class="border-b border-neutral-400">
            <th></th>
            <tr>
              <td class="w-6">
                <app-checkbox-control [ngModel]="allVehicles" (ngModelChange)="handleAllVehiclesClick($event)"></app-checkbox-control>
              </td>
              <td class="text-xs text-neutral-400 py-3">Registration plate</td>
              <td class="text-xs text-neutral-400">Brand, model</td>
              <td class="text-xs text-neutral-400">If assigned</td>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let vehicle of tempVehicles; trackByField: 'id'">
              <td>
                <app-checkbox-control [ngModel]="vehicle.checked" (ngModelChange)="handleCheckboxChange($event, vehicle.id)"></app-checkbox-control>
              </td>
              <td class="text-sm">{{ vehicle.registrationPlate }}</td>
              <td class="text-sm text-neutral-700">{{ vehicle.brand }} {{ vehicle.model }}</td>
              <td class="text-sm text-neutral-700">{{ vehicle.fleetName }}</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="flex items-center" (click)="isOpen = !isOpen" (keydown.enter)="isOpen = !isOpen">
        <span class="text-sm text-brand-500 font-semibold">Set camera channel</span>
        <div class="w-5 flex justify-center transform transition-transform" [ngClass]="isOpen ? 'rotate-90 text-brand-500' : 'text-neutral-700'">
          <svg width="4" height="5" viewBox="0 0 4 5" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M1.38894 4.63006C1.16794 4.85105 0.91246 4.90181 0.622485 4.78233C0.332495 4.66286 0.1875 4.44552 0.1875 4.1303V0.869218C0.1875 0.553999 0.332495 0.336657 0.622485 0.21719C0.91246 0.0977087 1.16794 0.148466 1.38894 0.369462L3.02451 2.00506C3.1008 2.08133 3.15521 2.15929 3.18774 2.23894C3.22028 2.31858 3.23655 2.40552 3.23655 2.49976C3.23655 2.594 3.22028 2.68093 3.18774 2.76057C3.15521 2.84023 3.1008 2.91819 3.02451 2.99446L1.38894 4.63006Z" fill="currentColor" />
          </svg>
        </div>
      </div>
      <table class="border-separate border-spacing-y-2" *ngIf="isOpen && eventForm">
        <thead class="border-b border-neutral-400">
          <th></th>
          <tr>
            <td class="text-xs text-neutral-400">Camera channel</td>
            <td class="text-xs text-neutral-400">Event</td>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let event of eventTypes">
            <td class="w-28">
              <app-text-control [formControl]="eventForm.controls[event.default_name]" [showHintSpace]="false" label="Channel"></app-text-control>
            </td>
            <td>
              <div class="flex gap-2 pl-4">
                <app-event-icon [eventIcon]="event.event_icon"></app-event-icon>
                <span class="text-sm">{{ event.name }}</span>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <span class="text-xs text-neutral-500">* - mandatory fields</span>
  </div>
  <div class="flex flex-1 justify-end" footer>
    <app-button [disabled]="false" (buttonClick)="data.type === 'create' ? handleFleetCreateClick() : handleEditFleetClick(data.fleet.id)">
      <span class="font-semibold text-sm text-white">Save</span>
    </app-button>
  </div>
</app-dialog-container>
