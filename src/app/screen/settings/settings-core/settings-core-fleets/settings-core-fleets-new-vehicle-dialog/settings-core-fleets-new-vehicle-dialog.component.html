<app-dialog-container [title]="title">
  <div class="flex flex-col p-1" body>
    <div *ngIf="currentMode === DialogMode.ADD_NEW" class="p-5 bg-white inline-flex flex-col justify-start items-start gap-6">
      <p class="text-lg">Add a new vehicle</p>
      <app-stepper [step]="currentStep" [type]="'create'"></app-stepper>
      <div [ngSwitch]="currentStep" class="w-full">
        <app-vehicle-lookup *ngSwitchCase="1" (next)="nextStep()" (prev)="previousStep()" (dvlaDataReceived)="handleDvlaDataReceived($event)"> </app-vehicle-lookup>
        <app-general-info *ngSwitchCase="2" [dvlaData]="dvlaData" [fleetOptions]="fleetOptions$" [bodyForm]="generalInfoBodyGroup" (next)="handleGeneralInfoNext()" (prev)="previousStep()"> </app-general-info>
        <app-providers-select *ngSwitchCase="3" (next)="nextStep()" (prev)="previousStep()"></app-providers-select>
        <app-success-add-vehicle *ngSwitchCase="4"></app-success-add-vehicle>
      </div>
    </div>

    <div *ngIf="currentMode === DialogMode.EDIT_VEHICLE" class="p-5 bg-white inline-flex flex-col justify-start items-start gap-6">
      <p class="text-lg">Edit vehicle</p>
      <app-stepper [step]="currentStep" [type]="'edit'"></app-stepper>
      <div [ngSwitch]="currentStep" class="w-full">
        <app-general-info *ngSwitchCase="1" [dvlaData]="dvlaData" (next)="nextStep()" (prev)="previousStep()"> </app-general-info>
        <app-providers-select *ngSwitchCase="2" (next)="nextStep()" (prev)="previousStep()"></app-providers-select>
      </div>
    </div>
  </div>
  <div footer class="flex flex-1 justify-end">
    <div *ngIf="currentMode === DialogMode.ADD_NEW && currentStep !== 3" class="flex justify-between w-full">
      <div class="flex-1"></div>

      <app-button type="quaternary" *ngIf="currentStep >= 2 && currentStep < 3" (click)="previousStep()" (keydown.enter)="previousStep()">
        <svg width="6" height="9" viewBox="0 0 6 9" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M1.71182 4.50002L5.1062 7.89419C5.22148 8.00961 5.2805 8.15468 5.28328 8.3294C5.28592 8.50398 5.22689 8.65169 5.1062 8.77252C4.98536 8.89322 4.83898 8.95356 4.66703 8.95356C4.49509 8.95356 4.3487 8.89322 4.22786 8.77252L0.482656 5.02731C0.404739 4.94926 0.34974 4.86697 0.317656 4.78044C0.285573 4.69391 0.269531 4.60044 0.269531 4.50002C0.269531 4.39961 0.285573 4.30613 0.317656 4.21961C0.34974 4.13308 0.404739 4.05079 0.482656 3.97273L4.22786 0.227522C4.34328 0.112244 4.48835 0.0532165 4.66307 0.0504387C4.83766 0.0477998 4.98536 0.106828 5.1062 0.227522C5.22689 0.348355 5.28724 0.494745 5.28724 0.666689C5.28724 0.838634 5.22689 0.985023 5.1062 1.10586L1.71182 4.50002Z" fill="#EE8444" />
        </svg>
        Back
      </app-button>

      <ng-container *ngIf="currentStep === 1">
        <app-button type="primary" [disabled]="(vehicleLookupLoading$ | async) === true" (click)="handleLookupAndProceedWithValidation()" (keydown.enter)="handleLookupAndProceedWithValidation()">
          {{ (vehicleLookupLoading$ | async) ? 'Searching...' : 'Lookup' }}
          <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M6.51955 12.6153C4.81188 12.6153 3.36571 12.023 2.18105 10.8385C0.996547 9.65385 0.404297 8.20768 0.404297 6.50002C0.404297 4.79235 0.996547 3.34618 2.18105 2.16152C3.36571 0.977016 4.81188 0.384766 6.51955 0.384766C8.22721 0.384766 9.67338 0.977016 10.858 2.16152C12.0425 3.34618 12.6348 4.79235 12.6348 6.50002C12.6348 7.21418 12.515 7.89627 12.2753 8.54627C12.0355 9.19627 11.7155 9.7616 11.3155 10.2423L17.0695 15.9963C17.208 16.1346 17.2789 16.3086 17.282 16.5183C17.2852 16.7279 17.2144 16.9052 17.0695 17.05C16.9247 17.1948 16.749 17.2673 16.5425 17.2673C16.3362 17.2673 16.1606 17.1948 16.0158 17.05L10.2618 11.296C9.7618 11.7088 9.1868 12.0319 8.5368 12.2653C7.8868 12.4986 7.21438 12.6153 6.51955 12.6153ZM6.51955 11.1155C7.80805 11.1155 8.89938 10.6683 9.79355 9.77402C10.6879 8.87985 11.135 7.78852 11.135 6.50002C11.135 5.21152 10.6879 4.12018 9.79355 3.22601C8.89938 2.33168 7.80805 1.88452 6.51955 1.88452C5.23105 1.88452 4.13971 2.33168 3.24555 3.22601C2.35121 4.12018 1.90405 5.21152 1.90405 6.50002C1.90405 7.78852 2.35121 8.87985 3.24555 9.77402C4.13971 10.6683 5.23105 11.1155 6.51955 11.1155Z" fill="white" />
          </svg>
        </app-button>
      </ng-container>

      <app-button type="primary" *ngIf="currentStep > 1 && currentStep < 3" (click)="nextStepWithValidation()" (keydown.enter)="nextStepWithValidation()">Continue</app-button>
    </div>

    <div *ngIf="currentMode === DialogMode.ADD_NEW && currentStep === 3" class="flex justify-between w-full">
      <div class="flex-1"></div>
      <app-button type="quaternary" *ngIf="currentStep >= 2 && currentStep <= 3" (click)="previousStep()" (keydown.enter)="previousStep()">
        <svg width="6" height="9" viewBox="0 0 6 9" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M1.71182 4.50002L5.1062 7.89419C5.22148 8.00961 5.2805 8.15468 5.28328 8.3294C5.28592 8.50398 5.22689 8.65169 5.1062 8.77252C4.98536 8.89322 4.83898 8.95356 4.66703 8.95356C4.49509 8.95356 4.3487 8.89322 4.22786 8.77252L0.482656 5.02731C0.404739 4.94926 0.34974 4.86697 0.317656 4.78044C0.285573 4.69391 0.269531 4.60044 0.269531 4.50002C0.269531 4.39961 0.285573 4.30613 0.317656 4.21961C0.34974 4.13308 0.404739 4.05079 0.482656 3.97273L4.22786 0.227522C4.34328 0.112244 4.48835 0.0532165 4.66307 0.0504387C4.83766 0.0477998 4.98536 0.106828 5.1062 0.227522C5.22689 0.348355 5.28724 0.494745 5.28724 0.666689C5.28724 0.838634 5.22689 0.985023 5.1062 1.10586L1.71182 4.50002Z" fill="#EE8444" />
        </svg>
        Back
      </app-button>
      <app-button type="primary" (keydown.enter)="createVehicle()" (click)="createVehicle()">
        {{ data.type === 'create' ? 'Create' : 'Save' }}
      </app-button>
    </div>

    <div *ngIf="currentMode === DialogMode.EDIT_VEHICLE && currentStep !== 2" class="flex justify-between w-full">
      <div class="flex-1"></div>
      <app-button type="primary" (keydown.enter)="nextStepWithValidation()" (click)="nextStepWithValidation()">Continue</app-button>
    </div>

    <div *ngIf="currentMode === DialogMode.EDIT_VEHICLE && currentStep === 2" class="flex justify-between w-full">
      <app-button type="quaternary" *ngIf="currentStep >= 1" (click)="previousStep()" (keydown.enter)="previousStep()">
        <svg width="6" height="9" viewBox="0 0 6 9" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M1.71182 4.50002L5.1062 7.89419C5.22148 8.00961 5.2805 8.15468 5.28328 8.3294C5.28592 8.50398 5.22689 8.65169 5.1062 8.77252C4.98536 8.89322 4.83898 8.95356 4.66703 8.95356C4.49509 8.95356 4.3487 8.89322 4.22786 8.77252L0.482656 5.02731C0.404739 4.94926 0.34974 4.86697 0.317656 4.78044C0.285573 4.69391 0.269531 4.60044 0.269531 4.50002C0.269531 4.39961 0.285573 4.30613 0.317656 4.21961C0.34974 4.13308 0.404739 4.05079 0.482656 3.97273L4.22786 0.227522C4.34328 0.112244 4.48835 0.0532165 4.66307 0.0504387C4.83766 0.0477998 4.98536 0.106828 5.1062 0.227522C5.22689 0.348355 5.28724 0.494745 5.28724 0.666689C5.28724 0.838634 5.22689 0.985023 5.1062 1.10586L1.71182 4.50002Z" fill="#EE8444" /></svg
        >Back
      </app-button>
      <app-button type="primary" (keydown.enter)="updateVehicle()" (click)="updateVehicle()">Save</app-button>
    </div>

    <div class="flex flex-row" *ngIf="currentMode === DialogMode.ADD_NEW && currentStep === 4">
      <app-button type="quaternary" (click)="closeDialog()" (keydown.enter)="closeDialog()"
        ><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
          <mask id="mask0_4753_17821" style="mask-type: alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="20" height="20">
            <rect width="20" height="20" fill="#D9D9D9" />
          </mask>
          <g mask="url(#mask0_4753_17821)">
            <path d="M7.95814 13.234L15.2931 5.89896C15.3742 5.81785 15.4699 5.77458 15.58 5.76917C15.69 5.76389 15.7909 5.80716 15.8827 5.89896C15.9747 5.99091 16.0206 6.09 16.0206 6.19625C16.0206 6.30264 15.9747 6.40174 15.8827 6.49354L8.42939 13.9519C8.29466 14.0865 8.13758 14.1538 7.95814 14.1538C7.77869 14.1538 7.62161 14.0865 7.48689 13.9519L4.11189 10.5769C4.03078 10.4958 3.98835 10.3994 3.9846 10.2877C3.98085 10.176 4.02494 10.0742 4.11689 9.98229C4.20869 9.89049 4.30772 9.84459 4.41397 9.84459C4.52036 9.84459 4.61946 9.89049 4.71126 9.98229L7.95814 13.234Z" fill="#EE8444" />
          </g>
        </svg>
        Finish
      </app-button>
      <app-button *appHasPermission="[[accessGroup.SETTINGS_VEHICLE_EVENT_STRATEGIES]]" type="primary" (keydown.enter)="handleVehicleCommissionClick(createdVehicle)" (click)="handleVehicleCommissionClick(createdVehicle)"> Vehicle commissions </app-button>
    </div>
  </div>
</app-dialog-container>
