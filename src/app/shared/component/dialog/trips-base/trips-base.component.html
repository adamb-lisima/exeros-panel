<div class="h-full flex flex-col gap-4" [class.loader]="tripLoading">
  <div class="flex justify-between items-center">
    <p class="font-semibold text-sm">{{ title }}</p>
  </div>
  <div class="h-full flex gap-2">
    <div class="flex-[0_0_300px]">
      <ng-container *ngIf="trips && trips.length > 0; else noTripsTemplate">
        <app-infinity-scroll [transparent]="true" [listGap]="true" [pageMeta]="tripsMeta ?? { total_items: 0, current_page: 0, first: true, last: true, fetch_in_background: false }" (nextPageRequest)="handleNextPageRequest($event)">
          <ng-container list>
            <div *ngFor="let tripItem of trips; trackBy: trackByField('id')" class="flex flex-col gap-2 p-4 rounded-lg cursor-pointer border" [ngClass]="tripItem.id === trip?.id ? 'border-main-primary' : 'border-bright-gray'" (keydown.enter)="handleTripClick(tripItem)" (click)="handleTripClick(tripItem)">
              <div class="flex justify-between items-center gap-2">
                <p class="text-sm font-bold">{{ tripItem.vehicle_registration_plate }}</p>
                <ng-container *ngIf="tripItem.status === 'DURING'; else completedStatusTemplate">
                  <div class="flex items-center gap-2 px-2 py-1 rounded-md bg-honeydew">
                    <svg class="text-extra-one" width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <circle cx="4" cy="4" r="4" fill="currentColor" />
                    </svg>
                    <p class="font-medium text-xs text-extra-one">LIVE</p>
                  </div>
                </ng-container>
                <ng-template #completedStatusTemplate>
                  <div class="flex items-center gap-1 py-1 px-2 rounded-md bg-anti-flash-white">
                    <svg class="text-extra-three" width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M11 3.61548V6.7463C11 7.02323 10.9706 7.28478 10.9043 7.52325C10.6321 8.65405 9.73437 9.36177 8.49816 9.36177H6.49669L4.27447 10.908C3.94334 11.1464 3.50184 10.8926 3.50184 10.4772V9.36177C2.75128 9.36177 2.12583 9.10023 1.69169 8.64638C1.25019 8.18482 1 7.53093 1 6.7463V3.61548C1 2.1539 1.86829 1.14617 3.20751 1.0154C3.30316 1.00771 3.39882 1 3.50184 1H8.49816C9.99927 1 11 2.0462 11 3.61548Z" stroke="currentColor" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                    <p class="font-medium text-xs text-extra-three">Completed</p>
                  </div>
                </ng-template>
              </div>
              <p class="text-xs opacity-50">{{ tripItem.start_time | dateFormat : 'serverDateTimeFormat' : 'clientDateTimeFormat' }}</p>
              <div class="flex gap-2">
                <svg width="20" height="100" viewBox="0 0 12 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <circle class="text-anti-flash-white" cx="6" cy="6" r="5.5" stroke="currentColor" />
                  <circle class="text-extra-three" cx="6.00065" cy="6.00065" r="2.66667" fill="currentColor" />
                  <line class="text-black" x1="6.5" y1="14.5" x2="6.5" y2="86.5" stroke="currentColor" stroke-linecap="round" stroke-dasharray="3 3" />
                  <path class="text-main-primary" d="M10.933 92.6356C10.4607 89.8558 7.64287 88.3986 5.02225 89.235C3.1932 89.818 1.99902 91.463 1.99902 93.5921C2.00935 94.3978 2.31794 95.3448 2.99706 96.1548C4.01611 97.3701 5.0617 98.5664 6.09402 99.7707C6.35726 100.078 6.64005 100.077 6.90513 99.7707C7.89788 98.6147 8.89063 97.4584 9.88338 96.3017C10.7974 95.2283 11.1642 94.0006 10.933 92.6356ZM6.50142 94.9236C6.15201 94.9241 5.81028 94.8254 5.51948 94.6399C5.22867 94.4544 5.00186 94.1905 4.86774 93.8815C4.73362 93.5725 4.69823 93.2324 4.76604 92.9041C4.83385 92.5758 5.00181 92.2742 5.24867 92.0374C5.49553 91.8006 5.8102 91.6392 6.15285 91.5737C6.49551 91.5083 6.85074 91.5416 7.17361 91.6695C7.49648 91.7974 7.77246 92.0142 7.96665 92.2924C8.16083 92.5706 8.26448 92.8977 8.26448 93.2323C8.26351 93.6801 8.07754 94.1093 7.7472 94.4262C7.41685 94.7431 6.96898 94.9219 6.50142 94.9236Z" fill="currentColor" />
                </svg>
                <div class="flex flex-col justify-between">
                  <p class="text-xs pb-2">{{ tripItem.from }}</p>
                  <div class="border-b border-new-gray-300"></div>
                  <p class="text-xs pt-2">{{ tripItem.to }}</p>
                </div>
              </div>
              <p class="text-xs opacity-50">{{ tripItem.end_time ? (tripItem.end_time | dateFormat : 'serverDateTimeFormat' : 'clientDateTimeFormat') : 'Ongoing trip' }}</p>
            </div>
          </ng-container>
        </app-infinity-scroll>
      </ng-container>

      <ng-template #noTripsTemplate>
        <div class="h-full flex flex-col items-center justify-center pt-16">
          <div class="text-gray-400 mb-4">
            <svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.618V7.382a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"></path>
            </svg>
          </div>
          <p class="text-sm font-medium text-gray-900 mb-1">No trips found</p>
          <p class="text-xs text-gray-500">This driver has no trips in the selected period</p>
        </div>
      </ng-template>
    </div>

    <app-map class="h-full w-full rounded-md border border-platinum" [center]="mapData?.center" [markers]="mapData?.markers" [polyline]="mapData?.polyline" [zoom]="6" [rounded]="true"> </app-map>
  </div>
</div>
